# 5. í´ë¡œì €

## 5-1. í´ë¡œì €ì˜ ì˜ë¯¸ ë° ì›ë¦¬ ì´í•´

### í´ë¡œì €

**â€œA closure is the combination of a function and the lexical environment within which that function was declared.â€** (MDN)

â†’ ì–´ë–¤ í•¨ìˆ˜ì—ì„œ ì„ ì–¸í•œ ë³€ìˆ˜ë¥¼ ì°¸ì¡°í•˜ëŠ” ë‚´ë¶€ í•¨ìˆ˜ì—ì„œë§Œ ë°œìƒí•˜ëŠ” í˜„ìƒ

```jsx
var outer = function() {
  var a = 1;
  var inner = function() {
    return ++a;
  };
  return inner;
};
var outer2 = outer(); // outerì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ ì¢…ë£Œ
console.log(outer2()); // 2
console.log(outer2()); // 3
```

- outer2 ë³€ìˆ˜ëŠ” outer()ì˜ ì‹¤í–‰ ê²°ê³¼ì¸ inner í•¨ìˆ˜ë¥¼ ì°¸ì¡°
- outerì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ì¢…ë£Œëœ í›„ inner í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ innerí•¨ìˆ˜ì˜ outerEnvironmentReferenceì¸ outer í•¨ìˆ˜ì˜ LexicalEnvironmentì— ì ‘ê·¼í•˜ì—¬ outerì—ì„œ ì„ ì–¸í•œ ë³€ìˆ˜ aë¥¼ ê°€ì ¸ì˜´.
    
    â†’ ê°€ë¹„ì§€ ì»¬ë ‰í„°ëŠ” ì–´ë–¤ ê°’ì„ ì°¸ì¡°í•˜ëŠ” ë³€ìˆ˜ê°€ í•˜ë‚˜ë¼ë„ ìˆë‹¤ë©´ ê·¸ ê°’ì€ ìˆ˜ì§‘ ëŒ€ìƒì— í¬í•¨ì‹œí‚¤ì§€ ì•Šê¸° ë•Œë¬¸
    
    <aside>
    ğŸ’¡ ìŠ¤í™ìƒìœ¼ë¡œëŠ” ì„ ì–¸ ë‹¹ì‹œì˜ LexicalEnvironment ì „ë¶€ë¥¼ GCí•˜ì§€ ì•Šë„ë¡ ë¼ ìˆìœ¼ë‚˜, 2019ë…„ ê¸°ì¤€ìœ¼ë¡œ í¬ë¡¬ì´ë‚˜ Node.js ë“±ì—ì„œ ì‚¬ìš© ì¤‘ì¸ V8 ì—”ì§„ì˜ ê²½ìš° ë‚´ë¶€ í•¨ìˆ˜ì—ì„œ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ëŠ” ë³€ìˆ˜ë§Œ ë‚¨ê²¨ë‘ê³  ë‚˜ë¨¸ì§€ëŠ” GCí•˜ë„ë¡ ìµœì í™”ë¼ ìˆìŠµë‹ˆë‹¤.
    
    </aside>
    
    â†’ ì´ì²˜ëŸ¼ í•¨ìˆ˜ì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ì¢…ë£Œëœ í›„ì—ë„ LexicalEnvironmentê°€ ê°€ë¹„ì§€ ì»¬ë ‰í„°ì˜ ìˆ˜ì§‘ ëŒ€ìƒì—ì„œ ì œì™¸ë˜ëŠ” ê²½ìš°ëŠ” ì§€ì—­ ë³€ìˆ˜ë¥¼ ì°¸ì¡°í•˜ëŠ” ë‚´ë¶€ í•¨ìˆ˜ê°€ ì™¸ë¶€ë¡œ ì „ë‹¬ëœ ê²½ìš°ê°€ ìœ ì¼
    
    ì¦‰, â€œì–´ë–¤ í•¨ìˆ˜ì—ì„œ ì„ ì–¸í•œ ë³€ìˆ˜ë¥¼ ì°¸ì¡°í•˜ëŠ” ë‚´ë¶€ í•¨ìˆ˜ì—ì„œë§Œ ë°œìƒí•˜ëŠ” í˜„ìƒâ€ì´ë€ â€œì™¸ë¶€ í•¨ìˆ˜ì˜ LexicalEnvironmentê°€ ê°€ë¹„ì§€ ì»¬ë ‰íŒ…ë˜ì§€ ì•ŠëŠ” í˜„ìƒâ€
    

í´ë¡œì €ë€ ì–´ë–¤ í•¨ìˆ˜ Aì—ì„œ ì„ ì–¸í•œ ë³€ìˆ˜ aë¥¼ ì°¸ì¡°í•˜ëŠ” ë‚´ë¶€ í•¨ìˆ˜ Bë¥¼ ì™¸ë¶€ë¡œ ì „ë‹¬í•  ê²½ìš° Aì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ì¢…ë£Œëœ ì´í›„ì—ë„ ë³€ìˆ˜ aê°€ ì‚¬ë¼ì§€ì§€ ì•ŠëŠ” í˜„ìƒì„ ë§í•œë‹¤.

### ë‚´ë¶€ í•¨ìˆ˜ë¥¼ ì™¸ë¶€ë¡œ ì „ë‹¬í•˜ëŠ” ê²½ìš°

- returnì„ í†µí•´ ë‚´ë¶€ í•¨ìˆ˜ë¥¼ ì „ë‹¬í•˜ëŠ” ê²½ìš°
- ë³„ë„ì˜ ì™¸ë¶€ê°ì²´ì¸ window ë©”ì„œë“œì— ì „ë‹¬í•  ì½œë°± í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì§€ì—­ë³€ìˆ˜ ì°¸ì¡°
    
    ```jsx
    // (1) setInterval/setTimeout
    (function() {
      var a = 0;
      var intervalId = null;
      var inner = function() {
        if (++a >= 10) {
          clearInterval(intervalId);
        }
        console.log(a);
      };
      intervalId = setInterval(inner, 1000);
    })();
    ```
    
- ë³„ë„ì˜ ì™¸ë¶€ ê°ì²´ì¸ DOMì˜ ë©”ì„œë“œì— ë“±ë¡í•  handler í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì§€ì—­ ë³€ìˆ˜ ì°¸ì¡°
    
    ```jsx
    // (2) eventListener
    (function() {
      var count = 0;
      var button = document.createElement('button');
      button.innerText = 'click';
      button.addEventListener('click', function() {
        console.log(++count, 'times clicked');
      });
      document.body.appendChild(button);
    })();
    ```
    

## 5-2. í´ë¡œì €ì™€ ë©”ëª¨ë¦¬ ê´€ë¦¬

- ë©”ëª¨ë¦¬ ëˆ„ìˆ˜: ê°œë°œìì˜ ì˜ë„ì™€ ë‹¬ë¦¬ ì–´ë–¤ ê°’ì˜ ì°¸ì¡° ì¹´ìš´íŠ¸ê°€ 0ì´ ë˜ì§€ ì•Šì•„ GCì˜ ìˆ˜ê±° ëŒ€ìƒì´ ë˜ì§€ ì•ŠëŠ” ê²½ìš°
- í´ë¡œì €ëŠ” ì˜ë„ì ìœ¼ë¡œ í•¨ìˆ˜ì˜ ì§€ì—­ ë³€ìˆ˜ë¥¼ ë©”ëª¨ë¦¬ë¥¼ ì†Œëª¨í•˜ë„ë¡ í•¨ìœ¼ë¡œì¨ ë°œìƒí•˜ë¯€ë¡œ, ê·¸ í•„ìš”ì„±ì´ ì‚¬ë¼ì§„ ì‹œì ì—ëŠ” ë”ëŠ” ë©”ëª¨ë¦¬ë¥¼ ì†Œëª¨í•˜ì§€ ì•Šê²Œ ë§Œë“¤ì–´ì¤€ë‹¤.
- ì°¸ì¡° ì¹´ìš´íŠ¸ë¥¼ 0ìœ¼ë¡œ ë§Œë“œëŠ” ë°©ë²•: ì‹ë³„ìì— ì°¸ì¡°í˜•ì´ ì•„ë‹Œ ê¸°ë³¸í˜• ë°ì´í„°(nullì´ë‚˜ undefined)ë¥¼ í• ë‹¹í•˜ê¸°

```jsx
// (1) returnì— ì˜í•œ í´ë¡œì €ì˜ ë©”ëª¨ë¦¬ í•´ì œ
var outer = (function() {
  var a = 1;
  var inner = function() {
    return ++a;
  };
  return inner;
})();
console.log(outer());
console.log(outer());
outer = null; // outer ì‹ë³„ìì˜ inner í•¨ìˆ˜ ì°¸ì¡°ë¥¼ ëŠìŒ
```

```jsx
// (2) setIntervalì— ì˜í•œ í´ë¡œì €ì˜ ë©”ëª¨ë¦¬ í•´ì œ
(function() {
  var a = 0;
  var intervalId = null;
  var inner = function() {
    if (++a >= 10) {
      clearInterval(intervalId);
      inner = null; // inner ì‹ë³„ìì˜ í•¨ìˆ˜ ì°¸ì¡°ë¥¼ ëŠìŒ
    }
    console.log(a);
  };
  intervalId = setInterval(inner, 1000);
})();
```

```jsx
// (3) eventListenerì— ì˜í•œ í´ë¡œì €ì˜ ë©”ëª¨ë¦¬ í•´ì œ
(function() {
  var count = 0;
  var button = document.createElement('button');
  button.innerText = 'click';

  var clickHandler = function() {
    console.log(++count, 'times clicked');
    if (count >= 10) {
      button.removeEventListener('click', clickHandler);
      clickHandler = null; // clickHandler ì‹ë³„ìì˜ í•¨ìˆ˜ ì°¸ì¡°ë¥¼ ëŠìŒ
    }
  };
  button.addEventListener('click', clickHandler);
  document.body.appendChild(button);
})();
```

## 5-3. í´ë¡œì € í™œìš© ì‚¬ë¡€

### 5-3-1. ì½œë°± í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì™¸ë¶€ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ê³ ì í•  ë•Œ

```jsx
var fruits = ['apple', 'banana', 'peach'];
var $ul = document.createElement('ul');

var alertFruit = function(fruit) {
  alert('your choice is ' + fruit);
};
fruits.forEach(function(fruit) {
  var $li = document.createElement('li');
  $li.innerText = fruit;
  $li.addEventListener('click', alertFruit); // [object MouseEvent]
  $ul.appendChild($li);
});
document.body.appendChild($ul);
alertFruit(fruits[1]);
```

- ì½œë°± í•¨ìˆ˜ì˜ ì¸ìì— ëŒ€í•œ ì œì–´ê¶Œì„ addEventListenerê°€ ê°€ì§„ ìƒíƒœì´ë©°, addEventListenerëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ ì²« ë²ˆì§¸ ì¸ìì— â€˜ì´ë²¤íŠ¸ ê°ì²´â€™ë¥¼ ì£¼ì…í•˜ê¸° ë•Œë¬¸

```jsx
fruits.forEach(function(fruit) {
  var $li = document.createElement('li');
  $li.innerText = fruit;
  $li.addEventListener('click', alertFruit.bind(null, fruit)); //
  $ul.appendChild($li);
});
```

- bind ë©”ì„œë“œë¥¼ í™œìš©í•´ í•´ê²°ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ì´ë ‡ê²Œ í•˜ë©´ ì´ë²¤íŠ¸ ê°ì²´ê°€ ì¸ìë¡œ ë„˜ì–´ì˜¤ëŠ” ìˆœì„œê°€ ë°”ë€ŒëŠ” ì , í•¨ìˆ˜ ë‚´ë¶€ì—ì„œì˜ thisê°€ ì›ë˜ì˜ ê·¸ê²ƒê³¼ ë‹¬ë¼ì§€ëŠ” ì ì„ ê°ì•ˆí•´ì•¼ í•œë‹¤.
    
    <aside>
    ğŸ’¡ bind ë©”ì„œë“œì˜ ì²« ë²ˆì§¸ ì¸ìê°€ ìƒˆë¡œ ë°”ì¸ë”©í•  thisì¸ë°, ì´ ê°’ì„ ìƒëµí•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì¼ë°˜ì ìœ¼ë¡œ ì›ë˜ì˜ thisë¥¼ ìœ ì§€í•˜ë„ë¡ í•  ìˆ˜ ì—†ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ë˜í•œ ìœ„ ì˜ˆì œì—ì„œëŠ” ë‘ ë²ˆì§¸ ì¸ìì— ì´ë²¤íŠ¸ ê°ì²´ê°€ ë„˜ì–´ì˜¬ ê²ƒì…ë‹ˆë‹¤.
    
    </aside>
    

```jsx
var fruits = ['apple', 'banana', 'peach'];
var $ul = document.createElement('ul');

var alertFruitBuilder = function(fruit) {
  return function() {
    alert('your choice is ' + fruit);
  };
};
fruits.forEach(function(fruit) {
  var $li = document.createElement('li');
  $li.innerText = fruit;
  $li.addEventListener('click', alertFruitBuilder(fruit));
  $ul.appendChild($li);
});
document.body.appendChild($ul);
```

- ê³ ì°¨í•¨ìˆ˜ ì´ìš©: í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ê±°ë‚˜ í•¨ìˆ˜ë¥¼ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜
    
    í´ë¦­ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ alertFruitBuilder ì•ˆì˜ ìµëª… í•¨ìˆ˜ì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ì—´ë¦¬ë©´ì„œ alertFruitBuilderì˜ ì¸ìë¡œ ë„˜ì–´ì˜¨ fruitë¥¼ outerEnvironmentReferenceì— ì˜í•´ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤. alertFruitBuilderì˜ ì‹¤í–‰ ê²°ê³¼ë¡œ ë°˜í™˜ëœ í•¨ìˆ˜ì—ëŠ” í´ë¡œì €ê°€ ì¡´ì¬.
    

### 5-3-2. ì ‘ê·¼ ê¶Œí•œ ì œì–´(ì •ë³´ ì€ë‹‰)

### 5-3-3. ë¶€ë¶„ ì ìš© í•¨ìˆ˜

### 5-3-4. ì»¤ë§ í•¨ìˆ˜

## 5-4. ì •ë¦¬
