# 02. this

> ### 전역 공간에서의 this
- 전역 객체를 가리킴
- 브라우저 환경에서 전역객체는 window
- Node.js 환경에서는 global
- 전역 변수 선언 시 JS 엔진은 전역 객체의 프로퍼티로 할당함 
- 따라서 window.변수명 , this.변수명으로 접근 가능
- JS의 모든 변수는 특정 객체의 프로퍼티로서 동작한다는 것을 알 수 있음
- 여기서 특정 객체는 실행 컨텍스트의 LexicalEnvironment 
- 따라서 var 변수 선언 대신 window의 프로퍼티에 직접 할당해도 var로 선언한 것과 똑같이 동작
- **예외상황(삭제) 주의**
  - 전역객체의 프로퍼티로 할당한 경우 delete 연산자로 삭제 가능
  - 전역변수로 선언한 경우 delete 연산자로 삭제 불가능 
  - 전역변수 선언 시 JS 엔진이 자동으로 전역객체의 프로퍼티로 할당 & 해당 프로퍼티의 configurable(변경 및 삭제 가능성) 속성을 false로 정의
  - 전역변수(var 선언) VS 전역객체의 프로퍼티는 **(1)호이스팅 여부** , **(2)configurable 여부**에서 차이가 있음

#    
> ### 메서드로 호출할 때 메서드 내부에서의 this
- 함수를 실행하는 방법 (1) 함수 호출, (2) 메서드 
- 함수  
  - 독립적인 기능 수행
- 메서드  
  - 자신을 호출한 대상 객체에 관한 동작 수행  
  - 함수 이름 앞에 객체가 명시된 경우(obj.method(1) / obj['method'])는 메서드로 호출한 것
- this는 호출한 주체에 대한 정보가 담김
- 어떤 함수를 메서드로 호출한 경우 호출 주체는 함수명 앞의 객체
- 점 표기법의 경우 마지막 점 앞에 명시된 객체가 곧 this 

#
> ### 함수로 호출할 때 함수 내부에서의 this
- 함수 내부에서의 this
  - 어떤 함수를 함수로서 호출할 경우에는 this가 지정되지 않음.
  - 함수로서 호출하는 것은 호출 주체를 명시하지 않는 것어서 호출 주체를 알 수 없기 때문
- 메서드의 내부함수에서의 this
  - this 바인딩에 대해서는 함수 호출 구문 앞에 점 or 대괄호 표기 여부가 관건
- 메서드 내부 함수에서의 this를 우회하는 방법
  - 변수 활용하기
- this를 바인딩하지 않는 함수
  - 화살표 함수  
  - 실행 컨텍스트 생성 시 this 바인딩 자체가 빠지게 되어 상위 스코프의 this를 그대로 활용 가능
 
#
 > ### 콜백 함수 호출 시 함수 내부에서의 this
 - 콜백 함수란? 
   - 함수 A의 제어권을 다른 함수 B에게 넘겨주는 경우 함수 A를 콜백 함수라 함.  
   - 콜백 함수도 함수이므로 this가 전역객체를 참조하지만, 제어권을 받은 함수에서 콜백 함수에 별도로 this가 될 대상을 지정한 경우 그 대상을 참조하게 됨

#
 > ### 생성자 함수 내부에서의 this  
- 생성자 함수란? 
  - 어떤 공통된 성질을 지니는 객체들을 생성하는 데 사용하는 함수
- this는 곧 새로 만들 구체적인 인스턴스가 됨  
  - (1) 생성자 함수를 호출  
  - (2)생성자의 prototype 프로퍼티를 참조하는 __proto__라는 프로퍼티가 있는 객체(인스턴스)를 만듦
  - (3)미리 준비된 공통 속성 및 개성을 해당 객체(this)에 부여


  ### 명시적으로 this를 바인딩하는 방법  
  #
   > ### call 메서드
- 메서드의 호출 주체인 함수를 즉시 실행하도록 하는 명령  
- call 메서드의 첫번째 인자를 this로 바인딩 후 인자를 호출한 함수의 매개변수로 함
- 함수를 그냥 실행하면 this는 전역 객체를 참조하지만 call 메서드를 이용하면 임의의 객체를 this로 지정 가능
    #
   > ### apply 메서드
- call 메서드와 기능적으로 동일
- 차이 > 두번째 인자를 배열로 받아 해당 배열의 요소를 호출할 함수의 매개변수로 지정함
    #
   > ### bind 메서드
- ES5에서 추가된 기능
- call과 비슷하나 즉시 호출하진 않고 넘겨받은 this 및 인수를 바탕으로 새로운 함수만 반환함 
- name 프로퍼티
  - name 프로퍼티에 bound라는 접두어가 붙음 
  - 어떤 함수의 name 프로퍼티가 'bound xxx'인 경우 : 원본 함수에 bind 메서드를 적용한 새로운 함수라는 뜻 , 코드 추적이 더 수월해짐
  #
   > ### 화살표 함수의 예외사항
- ES6에서 새롭게 도입
- this를 바인딩하는 과정이 제외
- this에 접근하고자 하면 스코프체인 상 가장 가까운 this에 접근
  #
   > ### 별도의 인자로 this를 받는 경우(콜백 함수 내에서의 this)
- foreach의 예
    ```javascript
        var report = {
            sum: 0; 
            count: 0; 
            add: function(){
                var args = Array.prototype.slice.call(arguments); 
                args.forEach(function(entry)){
                    this.sum += entry; 
                    ++this.count; 
                }, this); 
            }, 
            average: function(){
                return this.sum / this.count; 
            }
        }; 
        report.add(60, 85, 95); 
        console.log(report.sum, report.count, report.average()); 
``` 

#
출처: 코어 자바스크립트 (정재남 저)  
