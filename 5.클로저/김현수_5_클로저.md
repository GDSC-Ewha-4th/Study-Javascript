# 05클로저

## 클로저의 의미 및 원리 이해

- 클로저는 여러 함수형 프로그래밍 언어에서 등장하는 보편적 특성, js 고유의 개념은 아니다.
- mdn 에서의 클로저의 정의: A closure is the combination of a function and the lexcial environement within which that function was declared. "클로저는 함수와 그 함수가 선언될 당시의 lexical environment의 상호관계에 따른 현상"
- 이때 그 함수가 선언될 당시의 lexical environment 는 실행 컨텍스트의 구성 요소 중 하나인 outerEnvironmentReference 에 해당.
- combination 은 내부 함수에서 외부 변수를 참조하는 경우에 한해서만 일어난다. 따라서 클로저란 어떤 함수에서 선언한 변수를 참조하는 내부함수에서만 발생하는 현상이라 볼 수 있다.
- 가비지 콜렉터는 어떤 값을 참조하는 변수가 하나라도 있다면 그 값은 수집 대상에 포함시키지 않는다. 예제 5-3의 outer 함수는 실행 종료 시점에 inner 함수를 반환한다. 외부함수인 outer 의 실행이 종료되더라도 내부 함수인 inner 함수는 언젠가 outer2 를 실행함으로써 호출될 가능성이 열렸다. 언젠가 ㅑnner 함수의 실행 컨텍스트가 활성화되면 outerEnvironmentReference 가 outer 함수의 lexical environment 를 필요로 할 것이므로 수집 대상에서 제외된다.
- 이를 바탕으로 정의를 다시 고쳐보면, 클로저란 어떤 함수 A 에서 선언한 변수 a 를 참조하는 내부함수 B 를 외부로 전달할 경우 A 의 실행 컨텍스트가 종료된 이후에도 변수 a가 사라지지 않는 현상을 말한다.

## 클로저와 메모리 관리

- 클로저 사용에는 메모리 누수의 위험이 따른다.
- 관리 방법: 클로저는 어떤 필요에 의해 의도적으로 함수의 지역변수를 메모리를 소모하도록 함으로써 발생한다. 그렇다면 그 필요성이 사라진 시점에는 더는 메모리를 소모하지 않게 해주면 된다. 참조 카운트를 0으로 만들면 언젠가 콜렉터가 수거해 갈 것이고 이때 소모됐던 메모리가 회수될 것. 참조 카운트를 0으로 만들고 싶다면 식별자에 참조형이 아닌 기본형 데이터를 할당하면 된다.

## 클로저 활용 사례

- 1. 콜백 함수 내부에서 외부 데이터를 사용하고자 할 때
- 방법 3가지 1. 콜백 함수를 내부함수로 선언해서 외부변수를 직접 참조하는 방법 2. bind 를 활용한 방법 3. 콜백 함수를 고차함수로 바꿔서 클로저를 적극적으로 활용하는 방법
- 2. 접근 권한 제어(정보 은닉)
- 정보 은닉은 어떤 모듈의 내부 로직에 대해 외부로의 노출을 최소화해서 모듈간의 결합도를 낮추고 유연성을 높이고자 하는 현대 프로그래밍 언어의 중요한 개념 중 하나.
- 클로저를 사용하면 함수 차원에서 Public 한 값과 private 한 값을 구분하는 것이 가능하다.
- 3. 부분 적용 함수
- 부분 적용 함수란 n 개의 인자를 받는 함수에 미리 m개의 인자만 넘겨 기억시켰다가 나중에 n-m개의 인자를 넘기면 비로소 원래 함수의 실행 결과를 얻을 수 있게끔하는 함수이다. this 를 바인딩해야 하는 점을 제외하면 bind 함수의 실행 결과가 바로 부분 적용 함수이다,
- 클로저를 핵심 기법으로 사용하여 미리 일부 인자를 넘겨두어 기억하게끔 하고 추후 필요한 시점에 기억했던 인자들까지 함께 실행하게 한다는 개념이 클로저의 정의에 부합한다.
- 4. 커링 함수
- 커링 함수란 여러 개의 인자를 받는 함수를 하나의 인자만 받는 함수로 나눠서 순차적으로 호출될 수 있게 체인 형태로 구성한 것을 말한다. 부분 적용함수와 다른 것은, 커링은 한 번에 하나의 인자만 전달하는 것을 원칙으로 한다는 것, 그리고 중간 과정상의 함수를 실행한 결과는 그다음 인자를 받기 위해 대기만 할 뿐으로, 마지막 인자가 전달되기 전까지는 원본 함수가 실행되지 않는다.
- 커링 함수가 유용한 경우: 지연실행이 요긴한 상황 (당장 필요한 정보만 받아서 전달하고 또 필요한 정보가 들어오면 전달하는 식으로 해서 마지막 인자가 넘어갈 때까지 함수 실행을 미루는 경우)
